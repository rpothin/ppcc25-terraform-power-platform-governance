# Dependabot configuration for Power Platform Terraform Governance Repository
# This configuration ensures dependencies across all ecosystems are kept secure and up-to-date
# Tailored for Terraform, GitHub Actions, Docker containers, and Hugo documentation
#
# Configuration follows Azure Verified Module (AVM) best practices for:
# - Security-first approach with regular updates
# - Grouped updates to reduce PR noise
# - Strategic scheduling to avoid workflow conflicts
# - Comprehensive ecosystem coverage for enterprise governance

version: 2

# Configure update behavior and PR management
updates:
  # =============================================================================
  # GitHub Actions Dependencies
  # =============================================================================
  # Keeps all GitHub Actions and reusable workflows up to date
  # Critical for security as actions run with elevated permissions
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      # Weekly updates on Monday to start the work week with secure actions
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "UTC"
    
    # Group updates to reduce PR noise and enable easier testing
    groups:
      # Primary action updates - most commonly used and stable actions
      primary-actions:
        patterns:
          - "actions/checkout"
          - "actions/upload-artifact"
          - "actions/download-artifact"
          - "azure/login"
          - "hashicorp/setup-terraform"
        update-types:
          - "major"
          - "minor"
          - "patch"
      
      # Azure and cloud provider actions
      azure-actions:
        patterns:
          - "azure/*"
          - "*azure*"
        update-types:
          - "minor"
          - "patch"
      
      # Terraform-specific actions and tools
      terraform-actions:
        patterns:
          - "hashicorp/*"
          - "*terraform*"
        update-types:
          - "minor"
          - "patch"
    
    # Security and compliance configurations
    open-pull-requests-limit: 10
    allow:
      # Focus on production dependencies that affect security
      - dependency-type: "direct"
    
    # Custom labels for easy identification
    labels:
      - "dependencies"
      - "github-actions"
      - "security"
      - "auto-update"
    
    # Consistent commit message formatting
    commit-message:
      prefix: "chore(actions)"
      include: "scope"
    
    # Auto-assign for review
    assignees:
      - "rpothin"
    
    # Set milestone for tracking
    milestone: 1

  # =============================================================================
  # Terraform Dependencies 
  # =============================================================================
  # Manages Terraform provider versions and module dependencies
  # Essential for Power Platform provider updates and security patches
  - package-ecosystem: "terraform"
    directory: "/"
    schedule:
      # Semi-weekly schedule to catch important provider updates
      interval: "weekly"
      day: "wednesday"
      time: "08:00"
      timezone: "UTC"
    
    # Group Terraform updates by provider type
    groups:
      # Power Platform and Microsoft providers
      microsoft-providers:
        patterns:
          - "*powerplatform*"
          - "*azurerm*"
          - "*azuread*"
          - "*microsoft*"
        update-types:
          - "minor"
          - "patch"
      
      # HashiCorp core providers
      hashicorp-providers:
        patterns:
          - "hashicorp/*"
          - "*random*"
          - "*time*"
          - "*local*"
        update-types:
          - "patch"
      
      # Utility and helper providers
      utility-providers:
        patterns:
          - "*http*"
          - "*external*"
          - "*null*"
          - "*template*"
        update-types:
          - "patch"
    
    # Security-focused configuration
    open-pull-requests-limit: 8
    allow:
      - dependency-type: "direct"
    
    # Terraform-specific labels
    labels:
      - "dependencies"
      - "terraform"
      - "infrastructure"
      - "power-platform"
    
    commit-message:
      prefix: "feat(terraform)"
      include: "scope"
    
    assignees:
      - "rpothin"
    
    milestone: 1
    
    # Conservative versioning strategy for infrastructure
    versioning-strategy: "increase-if-necessary"

  # =============================================================================
  # Docker Dependencies (Dev Container & Actions)
  # =============================================================================
  # Manages base images and container dependencies for dev environments
  # Covers both .devcontainer configuration and any Dockerfiles
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "thursday"
      time: "10:00"
      timezone: "UTC"
    
    # Group Docker updates by purpose
    groups:
      # Microsoft development containers
      microsoft-devcontainers:
        patterns:
          - "mcr.microsoft.com/devcontainers/*"
          - "*universal*"
          - "*azure*"
        update-types:
          - "minor"
          - "patch"
      
      # Tool and utility containers
      tool-containers:
        patterns:
          - "*terraform*"
          - "*azure-cli*"
          - "*node*"
          - "*python*"
        update-types:
          - "patch"
    
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "docker"
      - "devcontainer"
      - "development"
    
    commit-message:
      prefix: "chore(docker)"
      include: "scope"
    
    assignees:
      - "rpothin"

  # =============================================================================
  # Dev Container Features
  # =============================================================================
  # Manages development container features and tools
  # Includes Terraform, Azure CLI, and VS Code extensions
  - package-ecosystem: "devcontainers"
    directory: "/"
    schedule:
      interval: "weekly"  
      day: "friday"
      time: "12:00"
      timezone: "UTC"
    
    # Group dev container features logically
    groups:
      # Infrastructure and cloud tools
      infrastructure-tools:
        patterns:
          - "*terraform*"
          - "*azure*"
          - "*tflint*"
          - "*terragrunt*"
        update-types:
          - "major"
          - "minor"
          - "patch"
      
      # Development productivity tools
      productivity-tools:
        patterns:
          - "*git*"
          - "*docker*"
          - "*node*"
          - "*python*"
        update-types:
          - "minor"
          - "patch"
    
    open-pull-requests-limit: 6
    labels:
      - "dependencies"
      - "devcontainer"
      - "development-tools"
      - "features"
    
    commit-message:
      prefix: "chore(devcontainer)"
      include: "scope"
    
    assignees:
      - "rpothin"

  # =============================================================================
  # Hugo Documentation Dependencies (if using modules or themes)
  # =============================================================================
  # Manages Hugo themes and documentation dependencies
  # Scoped to the docs directory that contains Hugo configuration
  - package-ecosystem: "gomod"
    directory: "/docs"
    schedule:
      interval: "monthly"
      day: "first"
      time: "14:00"  
      timezone: "UTC"
    
    groups:
      # Hugo core and theme dependencies
      hugo-dependencies:
        patterns:
          - "*hugo*"
          - "*theme*"
          - "*docs*"
        update-types:
          - "minor"
          - "patch"
    
    open-pull-requests-limit: 3
    labels:
      - "dependencies"
      - "documentation"
      - "hugo"
      - "go"
    
    commit-message:
      prefix: "docs(hugo)"
      include: "scope"
    
    assignees:
      - "rpothin"
    
    # Conservative approach for documentation dependencies
    versioning-strategy: "increase-if-necessary"

  # =============================================================================
  # Git Submodules (for Hugo themes or external modules)
  # =============================================================================
  # Manages any git submodules used in the project
  # Common for Hugo themes or external Terraform modules
  - package-ecosystem: "gitsubmodule"
    directory: "/"
    schedule:
      interval: "monthly"
      time: "16:00"
      timezone: "UTC"
    
    open-pull-requests-limit: 2
    labels:
      - "dependencies"
      - "submodules"
      - "external"
    
    commit-message:
      prefix: "chore(submodules)"
    
    assignees:
      - "rpothin"

# =============================================================================
# Global Configuration Notes
# =============================================================================
#
# Update Schedule Strategy:
# - Monday: GitHub Actions (start week with secure actions)
# - Wednesday: Terraform (mid-week for infrastructure updates)  
# - Thursday: Docker (prepare containers for development)
# - Friday: Dev Container Features (end week with tooling updates)
# - Monthly: Documentation and submodules (less critical updates)
#
# Security Priorities:
# 1. GitHub Actions (highest - run with elevated permissions)
# 2. Terraform providers (high - manage infrastructure)
# 3. Docker containers (medium - development environment)
# 4. Dev container features (medium - development tools)
# 5. Documentation (low - content-focused)
#
# Grouping Strategy:
# - Groups related updates to reduce PR noise
# - Enables batch testing of related dependencies
# - Separates major vs minor/patch updates for risk management
# - Groups by logical functionality (Microsoft, HashiCorp, etc.)
#
# AVM Compliance:
# - Conservative versioning strategies for infrastructure components
# - Comprehensive ecosystem coverage
# - Security-first update scheduling
# - Proper labeling and assignment for governance
# - Milestone tracking for release management
#
# Maintenance:
# - Review this configuration quarterly
# - Adjust schedules based on team workflows
# - Monitor PR volume and adjust open-pull-requests-limit
# - Update grouping patterns as new dependencies are added
