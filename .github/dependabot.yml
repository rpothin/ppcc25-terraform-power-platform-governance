# Dependabot configuration for Power Platform Terraform Governance Repository
# This configuration ensures dependencies across all ecosystems are kept secure and up-to-date
# Tailored for Terraform, GitHub Actions, Docker containers, and Hugo documentation
#
# Configuration follows Azure Verified Module (AVM) best practices for:
# - Security-first approach with regular updates
# - Grouped updates to reduce PR noise
# - Strategic scheduling to avoid workflow conflicts
# - Comprehensive ecosystem coverage for enterprise governance

version: 2

# Configure update behavior and PR management
updates:
  # =============================================================================
  # GitHub Actions Dependencies
  # =============================================================================
  # Keeps all GitHub Actions and reusable workflows up to date
  # Critical for security as actions run with elevated permissions
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      # Weekly updates on Monday to start the work week with secure actions
      interval: "weekly"
      day: "monday"
      time: "06:00"
      timezone: "UTC"

    # Group updates to reduce PR noise and enable easier testing
    groups:
      # GitHub core actions - most critical and frequently used
      github-core-actions:
        patterns:
          - "actions/checkout"
          - "actions/upload-artifact"
          - "actions/download-artifact"
          - "actions/setup-*"
          - "actions/github-script"
          - "actions/cache"
        update-types:
          - "major"
          - "minor"
          - "patch"

      # Microsoft and Azure ecosystem actions
      microsoft-actions:
        patterns:
          - "azure/*"
          - "microsoft/*"
          - "*azure*"
          - "*powerplatform*"
          - "*dotnet*"
        update-types:
          - "minor"
          - "patch"

      # HashiCorp ecosystem actions
      hashicorp-actions:
        patterns:
          - "hashicorp/*"
          - "*terraform*"
          - "*vault*"
          - "*consul*"
        update-types:
          - "minor"
          - "patch"

      # Security and scanning actions
      security-actions:
        patterns:
          - "github/codeql-action"
          - "aquasecurity/*"
          - "*security*"
          - "*scan*"
          - "*trivy*"
          - "*snyk*"
        update-types:
          - "minor"
          - "patch"

      # DevOps and utility actions
      devops-utility-actions:
        patterns:
          - "dorny/*"
          - "*filter*"
          - "*path*"
          - "*workflow*"
          - "*docker*"
          - "*container*"
        update-types:
          - "minor"
          - "patch"

    # Security and compliance configurations
    open-pull-requests-limit: 10
    allow:
      # Focus on production dependencies that affect security
      - dependency-type: "direct"

    # Custom labels for easy identification
    labels:
      - "dependencies"
      - "github-actions"
      - "security"
      - "auto-update"

    # Consistent commit message formatting
    commit-message:
      prefix: "chore(actions)"
      include: "scope"

    # Auto-assign for review
    assignees:
      - "rpothin"

    # Set milestone for tracking
    milestone: 1

  # =============================================================================
  # Terraform Dependencies
  # =============================================================================
  # Manages Terraform provider versions and module dependencies
  # Essential for Power Platform provider updates and security patches
  - package-ecosystem: "terraform"
    directory: "/"
    schedule:
      # Semi-weekly schedule to catch important provider updates
      interval: "weekly"
      day: "wednesday"
      time: "08:00"
      timezone: "UTC"

    # Group Terraform updates by provider ecosystem
    groups:
      # Microsoft ecosystem providers (Power Platform focus)
      microsoft-providers:
        patterns:
          - "microsoft/*"
          - "*powerplatform*"
          - "*azurerm*"
          - "*azuread*"
          - "*azapi*"
          - "*azuredevops*"
        update-types:
          - "minor"
          - "patch"

      # HashiCorp core providers and utilities
      hashicorp-providers:
        patterns:
          - "hashicorp/*"
          - "*random*"
          - "*time*"
          - "*local*"
          - "*null*"
          - "*external*"
          - "*template*"
          - "*tls*"
        update-types:
          - "patch"

      # Third-party and utility providers
      third-party-providers:
        patterns:
          - "*http*"
          - "*dns*"
          - "*kubernetes*"
          - "*helm*"
          - "*datadog*"
          - "*cloudflare*"
          - "*aws*"
          - "*google*"
          - "*github*"
        update-types:
          - "patch"

    # Security-focused configuration
    open-pull-requests-limit: 8
    allow:
      - dependency-type: "direct"

    # Terraform-specific labels
    labels:
      - "dependencies"
      - "terraform"
      - "infrastructure"
      - "power-platform"

    commit-message:
      prefix: "feat(terraform)"
      include: "scope"

    assignees:
      - "rpothin"

    milestone: 1

    # Conservative versioning strategy for infrastructure
    versioning-strategy: "increase-if-necessary"

  # =============================================================================
  # Docker Dependencies (Dev Container & Actions)
  # =============================================================================
  # Manages base images and container dependencies for dev environments
  # Covers both .devcontainer configuration and any Dockerfiles
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "thursday"
      time: "10:00"
      timezone: "UTC"

    # Group Docker updates by registry and purpose
    groups:
      # Microsoft container registry images
      microsoft-containers:
        patterns:
          - "mcr.microsoft.com/*"
          - "*devcontainers*"
          - "*universal*"
          - "*azure*"
          - "*dotnet*"
          - "*powershell*"
        update-types:
          - "minor"
          - "patch"

      # Development tool containers
      development-containers:
        patterns:
          - "*terraform*"
          - "*node*"
          - "*python*"
          - "*golang*"
          - "*ubuntu*"
          - "*debian*"
          - "*alpine*"
        update-types:
          - "patch"

      # Third-party registry containers
      third-party-containers:
        patterns:
          - "docker.io/*"
          - "ghcr.io/*"
          - "quay.io/*"
          - "registry.k8s.io/*"
        update-types:
          - "patch"

    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "docker"
      - "devcontainer"
      - "development"

    commit-message:
      prefix: "chore(docker)"
      include: "scope"

    assignees:
      - "rpothin"

  # =============================================================================
  # Dev Container Features
  # =============================================================================
  # Manages development container features and tools
  # Includes Terraform, Azure CLI, and VS Code extensions
  - package-ecosystem: "devcontainers"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "friday"
      time: "12:00"
      timezone: "UTC"

    # Group dev container features by category
    groups:
      # Infrastructure and cloud development tools
      infrastructure-tools:
        patterns:
          - "ghcr.io/devcontainers/features/terraform*"
          - "ghcr.io/devcontainers/features/azure-cli*"
          - "*terraform*"
          - "*azure*"
          - "*tflint*"
          - "*terragrunt*"
          - "*tfsec*"
          - "*checkov*"
          - "*kubectl*"
          - "*helm*"
        update-types:
          - "major"
          - "minor"
          - "patch"

      # Programming language runtimes
      language-runtimes:
        patterns:
          - "ghcr.io/devcontainers/features/python*"
          - "ghcr.io/devcontainers/features/node*"
          - "ghcr.io/devcontainers/features/go*"
          - "ghcr.io/devcontainers/features/dotnet*"
          - "*python*"
          - "*node*"
          - "*golang*"
          - "*dotnet*"
        update-types:
          - "minor"
          - "patch"

      # Development productivity and utility tools
      productivity-tools:
        patterns:
          - "ghcr.io/devcontainers/features/git*"
          - "ghcr.io/devcontainers/features/docker*"
          - "ghcr.io/devcontainers/features/github-cli*"
          - "*git*"
          - "*docker*"
          - "*vim*"
          - "*zsh*"
          - "*powershell*"
        update-types:
          - "minor"
          - "patch"

    open-pull-requests-limit: 6
    labels:
      - "dependencies"
      - "devcontainer"
      - "development-tools"
      - "features"

    commit-message:
      prefix: "chore(devcontainer)"
      include: "scope"

    assignees:
      - "rpothin"

  # =============================================================================
  # Hugo Documentation Dependencies (Go Modules)
  # =============================================================================
  # Manages Hugo themes and documentation dependencies when go.mod is present
  # Currently no go.mod exists, but patterns prepared for future Hugo modules
  - package-ecosystem: "gomod"
    directory: "/docs"
    schedule:
      interval: "monthly"
      day: "first"
      time: "14:00"
      timezone: "UTC"

    groups:
      # Hugo core dependencies and themes
      hugo-dependencies:
        patterns:
          - "github.com/gohugoio/*"
          - "*hugo*"
          - "*theme*"
          - "*docs*"
          - "*markdown*"
          - "*relearn*"
          - "*docsy*"
        update-types:
          - "minor"
          - "patch"

      # Go utility modules for documentation processing
      go-utilities:
        patterns:
          - "github.com/spf13/*"
          - "gopkg.in/*"
          - "*yaml*"
          - "*toml*"
          - "*json*"
        update-types:
          - "patch"

    open-pull-requests-limit: 3
    labels:
      - "dependencies"
      - "documentation"
      - "hugo"
      - "go"

    commit-message:
      prefix: "docs(hugo)"
      include: "scope"

    assignees:
      - "rpothin"

    # Conservative approach for documentation dependencies
    versioning-strategy: "increase-if-necessary"

  # =============================================================================
  # Git Submodules (for Hugo themes or external modules)
  # =============================================================================
  # Manages any git submodules used in the project
  # Common for Hugo themes or external Terraform modules
  - package-ecosystem: "gitsubmodule"
    directory: "/"
    schedule:
      interval: "monthly"
      time: "16:00"
      timezone: "UTC"

    open-pull-requests-limit: 2
    labels:
      - "dependencies"
      - "submodules"
      - "external"

    commit-message:
      prefix: "chore(submodules)"

    assignees:
      - "rpothin"

# =============================================================================
# Global Configuration Notes & Pattern Coverage Analysis
# =============================================================================
#
# Update Schedule Strategy:
# - Monday: GitHub Actions (start week with secure actions)
# - Wednesday: Terraform (mid-week for infrastructure updates)
# - Thursday: Docker (prepare containers for development)
# - Friday: Dev Container Features (end week with tooling updates)
# - Monthly: Documentation and submodules (less critical updates)
#
# Security Priorities:
# 1. GitHub Actions (highest - run with elevated permissions)
# 2. Terraform providers (high - manage infrastructure)
# 3. Docker containers (medium - development environment)
# 4. Dev container features (medium - development tools)
# 5. Documentation (low - content-focused)
#
# Comprehensive Pattern Coverage:
#
# GitHub Actions (100% current coverage + future-ready):
# âœ… actions/* - Core GitHub actions (checkout, upload-artifact, etc.)
# âœ… azure/* - Azure ecosystem actions
# âœ… microsoft/* - Microsoft ecosystem actions
# âœ… hashicorp/* - HashiCorp ecosystem actions
# âœ… github/codeql-action - Security scanning
# âœ… aquasecurity/* - Security tools (Trivy, etc.)
# âœ… dorny/* - DevOps utilities (path filters, etc.)
# ðŸ”® Future: *security*, *scan*, *snyk*, *docker*, *container*
#
# Terraform Providers (100% current coverage + ecosystem expansion):
# âœ… microsoft/* - Power Platform, AzureRM, Azure AD providers
# âœ… hashicorp/* - Core HashiCorp providers
# ðŸ”® Future: AWS, Google Cloud, Kubernetes providers
#
# Docker Images (current + anticipated future use):
# âœ… mcr.microsoft.com/* - Microsoft container registry
# âœ… ghcr.io/* - GitHub container registry
# ðŸ”® Future: docker.io/*, quay.io/*, registry.k8s.io/*
#
# DevContainer Features (comprehensive tool coverage):
# âœ… terraform, azure-cli, python, node - Current features
# ðŸ”® Future: go, dotnet, kubectl, helm, github-cli
#
# Documentation (prepared for Hugo modules):
# ðŸ”® Future: Hugo themes, Go modules for documentation processing
#
# Pattern Maintenance Strategy:
# - Patterns use wildcards strategically to reduce maintenance overhead
# - Grouped by logical ecosystems (Microsoft, HashiCorp, Security, etc.)
# - Separates critical security updates from routine maintenance
# - Accommodates anticipated future dependencies without modification
# - Each pattern documented with current and future dependency examples
#
# AVM Compliance:
# - Conservative versioning strategies for infrastructure components
# - Comprehensive ecosystem coverage beyond current dependencies
# - Security-first update scheduling with appropriate grouping
# - Proper labeling and assignment for governance workflows
# - Milestone tracking for release management alignment
#
# Pattern Validation (Last Updated: 2025-07-23):
# - All current dependencies verified against patterns
# - No ungrouped dependencies identified
# - Pattern conflicts analyzed and resolved
# - Future dependency patterns tested against common naming conventions
#
# Maintenance Schedule:
# - Review configuration quarterly (next: October 2025)
# - Update patterns when new dependency categories emerge
# - Monitor PR volume and adjust open-pull-requests-limit if needed
# - Validate pattern effectiveness against actual dependency updates
