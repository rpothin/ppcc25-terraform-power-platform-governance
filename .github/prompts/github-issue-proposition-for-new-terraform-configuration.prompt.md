---
mode: ask
model: Claude Sonnet 4
description: "Generate comprehensive GitHub issues for Terraform configuration implementation with GitHub Coding Agent compatibility"
---

# GitHub Issue Proposition for New Terraform Configuration

## ðŸŽ¯ Context & Mission
Generate a detailed, comprehensive, and actionable GitHub issue (title and description) that enables **GitHub Coding Agent** to implement the recommended Terraform configuration option following the PPCC25 Power Platform governance demonstration standards.

**Target Implementation**: {RECOMMENDED_OPTION_DETAILS}
**Configuration Type**: {res-|utl-|ptn-*}
**Resource/Provider**: {TARGET_RESOURCE_URL}
**Complexity Level**: {Low|Medium|High}

## ðŸ“‹ Issue Generation Framework

### Issue Title Format
```
[{MODULE_TYPE}] Implement {CONFIGURATION_NAME} - {BRIEF_DESCRIPTION}
```

**Examples**:
- `[res-*] Implement res-entra-groups - Entra ID Group Management Configuration`
- `[utl-*] Implement utl-export-users - Azure AD User Export Utility`
- `[ptn-*] Implement ptn-governance-suite - Complete Governance Pattern`

### Comprehensive Issue Description Structure

#### ðŸš¨ **SCOPE RESTRICTIONS - CRITICAL**
```markdown
## ðŸš¨ SCOPE RESTRICTIONS - CRITICAL

**â›” FORBIDDEN MODIFICATIONS**:
This GitHub issue implementation is **STRICTLY LIMITED** to the following scope:

### âœ… ALLOWED MODIFICATIONS
- **New Configuration Directory**: `configurations/{CONFIGURATION_NAME}/` and ALL contents within
- **CHANGELOG Update**: `CHANGELOG.md` - Add entry for new configuration only
- **Nothing Else**: No other files in the repository may be modified

### â›” STRICTLY FORBIDDEN
**DO NOT MODIFY, TOUCH, OR UPDATE ANY OF THE FOLLOWING FILES/DIRECTORIES**:
- âŒ `LICENSE` - Repository license file
- âŒ `README.md` (root) - Repository main README file  
- âŒ `config.env*` - Environment configuration files
- âŒ `.github/workflows/` - GitHub Actions workflows
- âŒ `.github/actions/` - GitHub Actions custom actions
- âŒ `scripts/` - Any existing scripts or utilities
- âŒ `docs/` - Documentation directory
- âŒ Any existing configuration directories (`configurations/res-*`, `configurations/utl-*`, etc.)
- âŒ Any other root-level files or directories

### ðŸ“‹ IMPLEMENTATION BOUNDARIES
**This issue covers ONLY**:
1. Creating the new configuration directory: `configurations/{CONFIGURATION_NAME}/`
2. Populating it with all required Terraform files
3. Adding a single entry to `CHANGELOG.md` documenting the new configuration
4. **NOTHING ELSE**

**Repository Documentation**:
- The README.md will be auto-generated by GitHub Actions - **DO NOT MODIFY**
- All other documentation is maintained separately - **DO NOT MODIFY**

**Violation Consequences**:
Any modifications outside this scope will result in issue rejection and implementation failure.
```

#### ðŸŽ¯ **Implementation Overview**
```markdown
## ðŸŽ¯ Implementation Overview

**Configuration Name**: `{CONFIGURATION_NAME}`
**Module Classification**: `{res-|utl-|ptn-*}`
**Primary Purpose**: {DETAILED_PURPOSE_DESCRIPTION}
**Target Resource**: [{RESOURCE_NAME}]({TERRAFORM_RESOURCE_URL})

**Success Criteria**:
- [ ] All validation gates pass (`terraform fmt --check`, `terraform validate`)
- [ ] Minimum test coverage achieved ({15+/20+/25+} assertions based on module type)
- [ ] AVM compliance maintained with Power Platform adaptations
- [ ] Documentation auto-generated via terraform-docs
- [ ] Repository standards followed per baseline and terraform-iac instructions
- [ ] **SCOPE COMPLIANCE**: Only new configuration directory and CHANGELOG.md modified

**Demonstration Value**:
This configuration supports the **"Enhancing Power Platform Governance Through Terraform: Embracing Infrastructure as Code"** (PPCC25 session) by demonstrating {EDUCATIONAL_VALUE_DESCRIPTION}.
```

#### ðŸ› ï¸ **Implementation Process**
```markdown
## ðŸ› ï¸ Implementation Process

**âš ï¸ CRITICAL**: Follow the process described in `.github/prompts/init-terraform-configuration.prompt.md` exactly.
**âš ï¸ SCOPE**: Modify ONLY the new configuration directory and CHANGELOG.md

### Phase 1: Template-Based Foundation
1. **Verify Template Existence**
   ```bash
   # Confirm template directory exists
   ls -la .github/terraform-configuration-template/
   ```

2. **Copy Template Directory** 
   ```bash
   # MANDATORY: Use copy command, never create files manually
   cp -r .github/terraform-configuration-template configurations/{CONFIGURATION_NAME}
   ```

3. **Template Customization**
   - Read copied `_header.md` and `_footer.md` from new configuration directory
   - Inventory ALL `{{PLACEHOLDER}}` variables
   - Replace placeholders systematically using values below
   - Verify `.terraform-docs.yml` references are correct

### Phase 2: Classification-Specific Implementation
4. **Core File Generation**
   - **`versions.tf`**: Provider version `~> 3.8` (centralized standard)
   - **`main.tf`**: Resource definitions with comprehensive comments
   - **`variables.tf`**: Strong typing, explicit object types (NO `type = any`)
   - **`outputs.tf`**: Anti-corruption layer implementation
   - **`tests/integration.tftest.hcl`**: Minimum {15+/20+/25+} assertions

5. **{MODULE_TYPE}-Specific Requirements**
   {CLASSIFICATION_SPECIFIC_REQUIREMENTS}

### Phase 3: Quality Assurance
6. **Mandatory Validation**
   ```bash
   cd configurations/{CONFIGURATION_NAME}
   
   # Format validation and correction
   terraform fmt --check            # Must pass
   terraform fmt --recursive        # Auto-fix if needed
   terraform fmt --check            # Re-verify

   # Syntax validation
   terraform validate                # Must pass

   # Comprehensive validation (if available)
   ../../scripts/utils/terraform-local-validation.sh --autofix {CONFIGURATION_NAME}
   ```

7. **Documentation & Integration**
   - Update `CHANGELOG.md` with new configuration entry **ONLY**
   - Ensure README.md will be auto-generated by GitHub Actions (**DO NOT MODIFY README.md**)
   - Verify all repository standards compliance within allowed scope
```

#### ðŸ“ **Template Placeholder Values**
```markdown
## ðŸ“ Template Placeholder Values

**Configuration Metadata**:
- `{{CONFIGURATION_TITLE}}`: "{HUMAN_READABLE_TITLE}"
- `{{CONFIGURATION_NAME}}`: "`{CONFIGURATION_NAME}`"
- `{{PRIMARY_PURPOSE}}`: "{PRIMARY_PURPOSE_DESCRIPTION}"

**Classification Values**:
- `{{CLASSIFICATION_PURPOSE}}`: "{CLASSIFICATION_PURPOSE}"
- `{{CLASSIFICATION_DESCRIPTION}}`: "{CLASSIFICATION_DESCRIPTION}"
- `{{TFFR2_IMPLEMENTATION}}`: "{ANTI_CORRUPTION_IMPLEMENTATION}"
- `{{WORKFLOW_TYPE}}`: "{WORKFLOW_TYPE}"

**Use Cases** (4 required):
- `{{USE_CASE_1}}`: "{USE_CASE_1}"
- `{{USE_CASE_1_DESCRIPTION}}`: "{USE_CASE_1_DESCRIPTION}"
- `{{USE_CASE_2}}`: "{USE_CASE_2}"
- `{{USE_CASE_2_DESCRIPTION}}`: "{USE_CASE_2_DESCRIPTION}"
- `{{USE_CASE_3}}`: "{USE_CASE_3}"
- `{{USE_CASE_3_DESCRIPTION}}`: "{USE_CASE_3_DESCRIPTION}"
- `{{USE_CASE_4}}`: "{USE_CASE_4}"
- `{{USE_CASE_4_DESCRIPTION}}`: "{USE_CASE_4_DESCRIPTION}"

**Integration & Documentation**:
- `{{TFVARS_EXAMPLE}}`: "{TFVARS_EXAMPLE_CONFIG}"
- `{{PERMISSION_CONTEXT}}`: "{PERMISSION_REQUIREMENTS}"
- `{{TROUBLESHOOTING_SPECIFIC}}`: "{CONFIGURATION_SPECIFIC_TROUBLESHOOTING}"
- `{{RESOURCE_DOCUMENTATION_TITLE}}`: "{OFFICIAL_DOCS_TITLE}"
- `{{RESOURCE_DOCUMENTATION_URL}}`: "{OFFICIAL_DOCS_URL}"
```

#### ðŸ”§ **Technical Specifications**
```markdown
## ðŸ”§ Technical Specifications

### Variable Requirements
- **Strong Typing**: All variables MUST use explicit object types
- **Validation**: Property-level validation for all object variables
- **Documentation**: HEREDOC descriptions with examples and validation reasoning
- **Error Messages**: Actionable guidance for validation failures

### Output Requirements  
- **Anti-Corruption Layer**: Discrete outputs, no full resource exposure
- **Required Outputs**: {MODULE_SPECIFIC_OUTPUT_REQUIREMENTS}
- **Summary Pattern**: Configuration/processing summary for validation

### Testing Requirements
- **Module Type**: {res-|utl-|ptn-*}
- **Minimum Assertions**: {15+/20+/25+} based on module classification
- **Test Types**: {plan only / plan + apply}
- **Performance**: Consolidated assertions in single run blocks

### Security & Compliance
- **Authentication**: OIDC only (no client secrets)
- **Provider Version**: `~> 3.8` for microsoft/power-platform
- **State Backend**: Azure Storage with OIDC
- **Lifecycle Management**: {res-* modules require lifecycle blocks}
```

#### ðŸ§ª **Validation Requirements**
```markdown
## ðŸ§ª Validation Requirements

### Mandatory Validation Gates
**All checks MUST pass before issue closure:**

1. **Format Validation**
   ```bash
   terraform fmt --check
   # Expected: No output (all files properly formatted)
   ```

2. **Syntax Validation**
   ```bash
   terraform validate
   # Expected: Success confirmation
   ```

3. **Comprehensive Validation (Optional Enhancement)**
   ```bash
   # Use repository validation script if available
   ./scripts/utils/terraform-local-validation.sh --autofix {CONFIGURATION_NAME}
   ```

4. **Test Coverage Validation**
   ```bash
   terraform test
   # Expected: All assertions pass, minimum count met
   ```

5. **Scope Compliance Validation**
   ```bash
   # Verify only allowed files modified
   git diff --name-only
   # Expected: Only configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
   ```

### Validation Fixes
If validation fails:
- **Format Issues**: Run `terraform fmt` to auto-correct
- **Syntax Issues**: Review error messages for actionable guidance  
- **Test Failures**: Verify assertion logic and resource configuration
- **Scope Violations**: Remove unauthorized file modifications immediately

**Autofix Available**: The `terraform-local-validation.sh` script provides comprehensive autofix for common issues.
```

#### ðŸ“š **Required Instructions Compliance**
```markdown
## ðŸ“š Required Instructions Compliance

**MANDATORY**: Follow these instruction files exactly:

### Baseline Instructions
- **File**: `.github/instructions/baseline.instructions.md`
- **Key Requirements**: 
  - Security by design (OIDC authentication)
  - Keep it simple (clarity over cleverness)
  - Modularity (200 lines max per file)
  - Reusability (no code duplication)
  - Clear comments (explain "why", not "what")

### Terraform IaC Instructions  
- **File**: `.github/instructions/terraform-iac.instructions.md`
- **Key Requirements**:
  - AVM compliance with Power Platform adaptations
  - Provider version consistency (`~> 3.8`)
  - Strong variable typing (no `type = any`)
  - Anti-corruption layer outputs
  - Lifecycle management for res-* modules
  - Minimum test coverage by module type

### AVM Terraform Specifications
- **Reference**: Azure Verified Modules Terraform specs
- **Application**: Follow AVM patterns where technically feasible
- **Adaptations**: Document any Power Platform provider limitations
- **Future Planning**: Design for eventual full AVM compliance
```

#### âœ… **Definition of Done**
```markdown
## âœ… Definition of Done

**Implementation Complete When**:
- [ ] Configuration created using template-based process
- [ ] All placeholder values replaced correctly
- [ ] Core files generated with proper classification patterns
- [ ] `terraform fmt --check` passes with no output
- [ ] `terraform validate` passes syntax validation
- [ ] Test coverage meets minimum requirements for module type
- [ ] Variables use explicit typing with comprehensive validation
- [ ] Outputs implement anti-corruption layer pattern
- [ ] Documentation generated via terraform-docs
- [ ] CHANGELOG.md updated with new configuration entry **ONLY**
- [ ] **SCOPE COMPLIANCE**: No unauthorized file modifications
- [ ] All repository standards and instructions followed within allowed scope
- [ ] Demonstrates PPCC25 educational objectives effectively

**Validation Commands**:
```bash
# Navigate to configuration
cd configurations/{CONFIGURATION_NAME}

# Validate formatting
terraform fmt --check

# Validate syntax  
terraform validate

# Run tests
terraform test

# Optional: Comprehensive validation
../../scripts/utils/terraform-local-validation.sh {CONFIGURATION_NAME}

# Verify scope compliance
cd ../../
git diff --name-only
# Should show ONLY: configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
```

**Review Criteria**:
- Code demonstrates quickstart guide principles
- Implementation shows ClickOps to IaC transition
- Examples are clear and educational
- Troubleshooting guidance included
- Power Platform governance context maintained
- **Scope compliance maintained**: Only allowed files modified
```

---

## ðŸ”§ Classification-Specific Templates

### For res-* (Resource Modules)
```markdown
**Classification Values**:
- `{{CLASSIFICATION_PURPOSE}}`: "Resource Deployment"
- `{{CLASSIFICATION_DESCRIPTION}}`: "Deploys primary Power Platform resources following WAF best practices"
- `{{TFFR2_IMPLEMENTATION}}`: "outputting resource IDs and computed attributes as discrete outputs"
- `{{WORKFLOW_TYPE}}`: "Resource Deployment Workflows"

**Specific Requirements**:
- **Lifecycle Blocks**: MANDATORY for all resources
- **Test Coverage**: Minimum 20 assertions (plan + apply tests)
- **Environment Support**: Consider tfvars/ directory for multi-environment
- **State Management**: Include lifecycle ignore_changes for manual admin center changes
```

### For utl-* (Utility Modules)  
```markdown
**Classification Values**:
- `{{CLASSIFICATION_PURPOSE}}`: "Data Export and Analysis"
- `{{CLASSIFICATION_DESCRIPTION}}`: "Provides reusable data sources without deploying resources"  
- `{{TFFR2_IMPLEMENTATION}}`: "outputting discrete computed attributes instead of full resource objects"
- `{{WORKFLOW_TYPE}}`: "Data Export Workflows"

**Specific Requirements**:
- **No Resource Deployment**: Only data sources and local values
- **Test Coverage**: Minimum 15 assertions (plan tests only)
- **Output Focus**: Comprehensive data export outputs
- **Performance**: Optimize for large dataset processing
```

### For ptn-* (Pattern Modules)
```markdown
**Classification Values**:
- `{{CLASSIFICATION_PURPOSE}}`: "Pattern Implementation"
- `{{CLASSIFICATION_DESCRIPTION}}`: "Deploys multiple resources using composable patterns"
- `{{TFFR2_IMPLEMENTATION}}`: "outputting key resource identifiers and computed values from the pattern"
- `{{WORKFLOW_TYPE}}`: "Pattern Deployment Workflows"

**Specific Requirements**:
- **Multi-Resource**: Orchestrate multiple Power Platform resources
- **Test Coverage**: Minimum 25 assertions (plan + apply tests)  
- **Dependency Management**: Handle resource dependencies carefully
- **Rollback Strategy**: Include rollback scenarios in testing
```

---

## ðŸ“‹ Usage Instructions

**To generate a GitHub issue:**

1. **Specify the implementation details** (recommended option from feasibility analysis)
2. **Provide classification type** (res-, utl-, or ptn-)
3. **Include target resource information** (Terraform provider resource URL)
4. **Replace template variables** with specific configuration details
5. **Customize placeholder values** based on module classification
6. **Verify all required sections** are included and accurate

**The generated issue will provide GitHub Coding Agent with**:
- Step-by-step implementation process
- All required validation commands
- Comprehensive technical specifications
- Clear success criteria and definition of done
- Repository standards compliance requirements
- **Strict scope restrictions** to prevent unauthorized modifications

This enhanced prompt creates actionable GitHub issues that eliminate ambiguity and ensure successful Terraform configuration implementation through automated agents while protecting repository integrity through clearly defined scope restrictions.