---
mode: agent
description: "Creates new Terraform configurations aligned with Azure Verified Modules (AVM) principles and repository standards using a template-based approach."
---

# ğŸš€ Terraform Configuration Initialization (Template-Based)

You are tasked with creating a new Terraform configuration aligned with Azure Verified Modules (AVM) principles and repository standards. This process uses a template-based approach for maximum consistency and simplicity.

## ğŸ“‹ Task Definition

**Create a new Terraform configuration using the standardized template, then apply classification-specific customization.**

### Required Information Collection

Before proceeding, **MUST** collect the following information from the user:

1. **AVM Module Classification** (Required):
  - `res-*` - **Resource Module**: Deploy primary Power Platform resources
  - `ptn-*` - **Pattern Module**: Deploy multiple resources as a pattern
  - `utl-*` - **Utility Module**: Implement reusable data sources/functions

2. **Configuration Name** (Required):
  - Must follow naming convention: `{classification}-{descriptive-name}`
  - Examples: `res-dlp-policy`, `ptn-environment`, `utl-export-dlp-policies`

3. **Primary Purpose** (Required):
  - Brief description of what the configuration will accomplish

4. **Environment Support** (Optional):
  - Whether multi-environment support is needed (creates tfvars/ subdirectory)
  - Default: Single environment unless specified

---

## ğŸ—ï¸ Initialization Workflow

### Phase 1: Template-Based Foundation

1. **Copy Template Directory**
  - `cp -r .github/terraform-configuration-template configurations/{configuration-name}`
2. **Replace Placeholders**
  - Replace all `{{PLACEHOLDER}}` variables in `_header.md` and `_footer.md` with user-provided and classification-specific values
3. **Validate Base Structure**
  - Ensure template copied and placeholders replaced correctly

### Phase 2: Classification-Specific Customization

4. **Generate Core Files**
  - Create `versions.tf`, `main.tf` based on classification
5. **Add Variables** (res-*, ptn-*, utl-*)
  - Create `variables.tf` with input parameters if needed
6. **Add Outputs** (utl-*, some res-* and ptn-*)
  - Create `outputs.tf` for anti-corruption layer/data export if required
7. **Create tfvars** (res-*, ptn-*)
  - Generate `tfvars/` directory and environment files if multi-environment support is needed
8. **Create Tests**
  - Add `tests/integration.tftest.hcl` with basic validation

### Phase 3: Finalization

9. **Validate Structure**
   - Ensure AVM compliance and repository standards
10. **Update Changelog**
   - Add entry for new configuration

---

## âš¡ Execution Instructions

1. **Confirm Understanding**: State the configuration to be created and its classification
2. **Validate Inputs**: Ensure naming follows conventions and requirements are clear
3. **Copy and Prepare Template**: Copy template, rename files, and replace placeholders
4. **Customize for Classification**: Add/modify files as needed for resource, pattern, or utility module
5. **Test and Document**: Validate syntax and update changelog

---

## ğŸ“ File Structure (After Initialization)

```
configurations/{configuration-name}/
â”œâ”€â”€ main.tf
â”œâ”€â”€ variables.tf
â”œâ”€â”€ outputs.tf
â”œâ”€â”€ versions.tf
â”œâ”€â”€ README.md (automatically generated by GitHub Actions when new configuration is pushed)
â”œâ”€â”€ .terraform-docs.yml
â”œâ”€â”€ _header.md
â”œâ”€â”€ _footer.md
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ integration.tftest.hcl
â””â”€â”€ tfvars/
   â”œâ”€â”€ dev.tfvars
   â”œâ”€â”€ staging.tfvars
   â””â”€â”€ prod.tfvars
```

---

## ğŸ“ Notes

- The template provides a consistent starting point for all configurations.
- Placeholder replacement ensures documentation and metadata are always up to date.
- Classification-specific logic (resource, pattern, utility) is applied after the template is in place.

**Ready to proceed? Please provide the module classification, configuration name, and primary purpose.**