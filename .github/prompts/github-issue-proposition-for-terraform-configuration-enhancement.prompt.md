---
mode: ask
model: Claude Sonnet 4
description: "Generate comprehensive GitHub issues for enhancing existing Terraform configurations with GitHub Coding Agent compatibility"
---

# GitHub Issue Proposition for Terraform Configuration Enhancement

## üéØ Context & Mission
Generate a detailed, comprehensive, and actionable GitHub issue (title and description) that enables **GitHub Coding Agent** to enhance an existing Terraform configuration following the PPCC25 Power Platform governance demonstration standards.

**Target Configuration**: {EXISTING_CONFIGURATION_NAME}
**Enhancement Type**: {feature|fix|optimization|compliance|security}
**Enhancement Details**: {ENHANCEMENT_DESCRIPTION}
**Complexity Level**: {Low|Medium|High}

## üìã Issue Generation Framework

### Issue Title Format
```
[{MODULE_TYPE}] Enhance {CONFIGURATION_NAME} - {ENHANCEMENT_DESCRIPTION}
```

**Examples**:
- `[res-*] Enhance res-dlp-policy - Add Multi-Environment Support`
- `[utl-*] Enhance utl-export-connectors - Optimize Performance for Large Datasets`
- `[ptn-*] Enhance ptn-governance-suite - Add Advanced Security Controls`

### Comprehensive Issue Description Structure

#### ‚õî STOP - READ THIS FIRST ‚õî
```markdown
# [{MODULE_TYPE}] Enhance {CONFIGURATION_NAME} - {ENHANCEMENT_DESCRIPTION}

## ‚õî STOP - READ THIS FIRST ‚õî

**BEFORE YOU START - VALIDATE YOUR SCOPE:**

```bash
# MANDATORY: Run this command first to confirm allowed modifications
echo "ALLOWED FILES:"
echo "‚úÖ MODIFY: configurations/{CONFIGURATION_NAME}/*"
echo "‚úÖ UPDATE: CHANGELOG.md (add one entry only)"
echo ""
echo "üö´ FORBIDDEN FILES (DO NOT TOUCH):"
echo "‚ùå LICENSE"
echo "‚ùå README.md"  
echo "‚ùå config.env*"
echo "‚ùå .github/*"
echo "‚ùå scripts/*"
echo "‚ùå docs/*"
echo "‚ùå Any other configurations/*"
echo "‚ùå Any other files"
```

## üö® CRITICAL IMPLEMENTATION RULES

### RULE 1: ENHANCE ONLY, DO NOT CREATE NEW CONFIGURATIONS
```bash
# ‚úÖ ALLOWED: Modify existing configuration files
# Example: configurations/{CONFIGURATION_NAME}/main.tf

# ‚ùå FORBIDDEN: Create new configuration directories
# ‚ùå FORBIDDEN: Modify files outside target configuration
```

### RULE 2: TWO-SCOPE MODIFICATION LIMIT
**EXACTLY 2 scopes of file changes allowed:**
1. **EXISTING CONFIGURATION**: `configurations/{CONFIGURATION_NAME}/*` (modify existing files, add new files within this directory only)
2. **ONE EXISTING FILE UPDATE**: `CHANGELOG.md` (add single entry only)

### RULE 3: VALIDATE BEFORE PROCEEDING
```bash
# MANDATORY: Run before making ANY changes
git status --porcelain
# Expected output: Nothing (clean working directory)

# MANDATORY: Verify target configuration exists
ls -la configurations/{CONFIGURATION_NAME}/
# Expected: Directory exists with Terraform files

# MANDATORY: After all changes, verify scope compliance
git status --porcelain
git diff --name-only
# Expected: Only configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
```

### RULE 4: IMMEDIATE STOP CONDITIONS
**STOP IMPLEMENTATION IMMEDIATELY IF:**
- You consider modifying `LICENSE`
- You consider modifying `README.md` 
- You consider modifying any file in `.github/`
- You consider modifying any file in `scripts/`
- You consider modifying any file in `docs/`
- You consider creating new configuration directories
- Git diff shows unauthorized files

## ‚ö†Ô∏è ENFORCEMENT MECHANISM

**These files are PROTECTED and will cause FAILURE if modified:**
- `LICENSE` - Repository license (managed separately)
- `README.md` - Auto-generated by GitHub Actions
- `.github/workflows/*` - CI/CD automation (managed separately)
- `scripts/*` - Utility scripts (managed separately)
- `docs/*` - Documentation (managed separately)
- Any other `configurations/*/` - Other configurations (managed separately)

**Validation Command (run after implementation):**
```bash
# This command MUST show only allowed changes
git diff --name-only HEAD
# PASS: Only shows configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
# FAIL: Shows any other files (implementation must be rejected)
```

## üîí PRE-IMPLEMENTATION CHECKLIST

**Complete ALL items before proceeding:**
- [ ] Confirmed working directory is clean (`git status`)
- [ ] Verified target configuration exists (`configurations/{CONFIGURATION_NAME}/`)
- [ ] Understood only target configuration scope can be modified
- [ ] Read and acknowledged scope restrictions above
- [ ] Will NOT touch LICENSE, README.md, .github/*, scripts/*, docs/*
- [ ] Will NOT create new configuration directories
- [ ] Will validate scope compliance after implementation
```

#### üéØ **Enhancement Overview**
```markdown
## üéØ Enhancement Overview

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

**Target Configuration**: `configurations/{CONFIGURATION_NAME}/`
**Enhancement Type**: {feature|fix|optimization|compliance|security}
**Primary Enhancement**: {DETAILED_ENHANCEMENT_DESCRIPTION}
**Current State Analysis**: {CURRENT_CONFIGURATION_ANALYSIS}

**Enhancement Objectives**:
- [ ] {OBJECTIVE_1}
- [ ] {OBJECTIVE_2}
- [ ] {OBJECTIVE_3}
- [ ] All validation gates pass (`terraform fmt --check`, `terraform validate`)
- [ ] Existing test coverage maintained or improved
- [ ] AVM compliance maintained with Power Platform adaptations
- [ ] Documentation auto-updated via terraform-docs
- [ ] Repository standards followed per baseline and terraform-iac instructions
- [ ] **SCOPE COMPLIANCE**: Only target configuration and CHANGELOG.md modified

**Demonstration Value**:
This enhancement supports the **"Enhancing Power Platform Governance Through Terraform: Embracing Infrastructure as Code"** (PPCC25 session) by demonstrating {EDUCATIONAL_VALUE_DESCRIPTION}.
```

#### üõ†Ô∏è **Enhancement Process**
```markdown
## üõ†Ô∏è Enhancement Process

**‚ö†Ô∏è CRITICAL**: Maintain all existing functionality while adding enhancements.
**‚ö†Ô∏è SCOPE**: Modify ONLY the target configuration directory and CHANGELOG.md

### Phase 1: Current State Analysis

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

1. **Analyze Existing Configuration**
   ```bash
   # Review current configuration structure
   ls -la configurations/{CONFIGURATION_NAME}/
   
   # Understand current implementation
   cat configurations/{CONFIGURATION_NAME}/main.tf
   cat configurations/{CONFIGURATION_NAME}/variables.tf
   cat configurations/{CONFIGURATION_NAME}/outputs.tf
   ```

2. **Validate Current State**
   ```bash
   cd configurations/{CONFIGURATION_NAME}
   
   # Ensure current configuration is valid
   terraform fmt --check
   terraform validate
   terraform test  # If tests exist
   
   # Document current validation state
   cd ../../
   git status --porcelain  # Should be clean
   ```

3. **Backup Current Implementation**
   ```bash
   # Create mental snapshot of current functionality
   # Document any breaking changes that must be avoided
   ```

### Phase 2: Enhancement Implementation

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

4. **Implement Enhancements**
   - **{ENHANCEMENT_AREA_1}**: {ENHANCEMENT_DETAILS_1}
   - **{ENHANCEMENT_AREA_2}**: {ENHANCEMENT_DETAILS_2}
   - **{ENHANCEMENT_AREA_3}**: {ENHANCEMENT_DETAILS_3}

5. **Maintain Backward Compatibility**
   - Preserve existing variable interfaces (avoid breaking changes)
   - Maintain existing output structure unless explicitly enhanced
   - Ensure existing functionality continues to work
   - Add new features as optional extensions

6. **Update Configuration Files**
   - **`main.tf`**: Implement core enhancements with comprehensive comments
   - **`variables.tf`**: Add new variables if needed, maintain existing ones
   - **`outputs.tf`**: Enhance outputs while preserving existing structure
   - **`tests/integration.tftest.hcl`**: Update or add tests to cover enhancements
   - **Other files**: Modify as needed within scope

### Phase 3: Quality Assurance

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

7. **Enhanced Validation**
   ```bash
   cd configurations/{CONFIGURATION_NAME}
   
   # Format validation and correction
   terraform fmt --check            # Must pass
   terraform fmt --recursive        # Auto-fix if needed
   terraform fmt --check            # Re-verify

   # Syntax validation
   terraform validate                # Must pass

   # Test validation (enhanced coverage)
   terraform test                    # Must pass with enhanced coverage

   # Comprehensive validation (if available)
   ../../scripts/utils/terraform-local-validation.sh --autofix {CONFIGURATION_NAME}
   
   # Validate scope compliance
   cd ../../
   git diff --name-only
   # Should only show configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
   ```

8. **Documentation & Integration**
   - Update `CHANGELOG.md` with enhancement details **ONLY**
   - Ensure README.md will be auto-generated by GitHub Actions (**DO NOT MODIFY README.md**)
   - Verify all repository standards compliance within allowed scope
   - Document enhancement rationale in code comments
   
   ```bash
   # Final scope validation
   git diff --name-only
   # MUST show only: configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
   ```
```

#### üìù **Enhancement Specifications**
```markdown
## üìù Enhancement Specifications

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

### Enhancement Areas

**Primary Enhancement**: {PRIMARY_ENHANCEMENT_DESCRIPTION}
- **Current Limitation**: {CURRENT_LIMITATION_DESCRIPTION}
- **Proposed Solution**: {PROPOSED_SOLUTION_DESCRIPTION}
- **Implementation Approach**: {IMPLEMENTATION_APPROACH}

**Secondary Enhancements** (if applicable):
- **{ENHANCEMENT_2}**: {ENHANCEMENT_2_DESCRIPTION}
- **{ENHANCEMENT_3}**: {ENHANCEMENT_3_DESCRIPTION}

### Compatibility Requirements
- **Backward Compatibility**: Maintain all existing functionality
- **Variable Interface**: Preserve existing variable names and types
- **Output Interface**: Enhance outputs without breaking existing consumers
- **Test Compatibility**: Existing tests must continue to pass

### New Features (if applicable)
- **{NEW_FEATURE_1}**: {NEW_FEATURE_1_DESCRIPTION}
- **{NEW_FEATURE_2}**: {NEW_FEATURE_2_DESCRIPTION}

### Performance Considerations
- **{PERFORMANCE_ASPECT_1}**: {PERFORMANCE_CONSIDERATION_1}
- **{PERFORMANCE_ASPECT_2}**: {PERFORMANCE_CONSIDERATION_2}
```

#### üîß **Technical Specifications**
```markdown
## üîß Technical Specifications

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

### Variable Enhancement Requirements
- **Maintain Existing**: All current variables must remain functional
- **Strong Typing**: Any new variables MUST use explicit object types
- **Validation**: Property-level validation for all new object variables
- **Documentation**: HEREDOC descriptions with examples and validation reasoning
- **Error Messages**: Actionable guidance for validation failures

### Output Enhancement Requirements  
- **Preserve Existing**: All current outputs must remain available
- **Anti-Corruption Layer**: New outputs follow discrete pattern, no full resource exposure
- **Enhanced Outputs**: {ENHANCED_OUTPUT_REQUIREMENTS}
- **Summary Pattern**: Enhanced configuration/processing summary for validation

### Testing Enhancement Requirements
- **Maintain Coverage**: Existing test coverage must be preserved
- **Enhanced Assertions**: Add assertions for new functionality
- **Performance Tests**: Consider performance validation for optimization enhancements
- **Regression Tests**: Ensure existing functionality continues to work

### Security & Compliance Enhancement
- **Authentication**: Maintain OIDC only (no client secrets)
- **Provider Version**: Maintain `~> 3.8` for microsoft/power-platform
- **State Backend**: Azure Storage with OIDC
- **Lifecycle Management**: Enhanced lifecycle blocks if needed for {res-* modules}
- **Security Improvements**: {SECURITY_ENHANCEMENT_DETAILS}
```

#### üß™ **Validation Requirements**
```markdown
## üß™ Validation Requirements

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

### Mandatory Validation Gates
**All checks MUST pass before issue closure:**

1. **Format Validation**
   ```bash
   terraform fmt --check
   # Expected: No output (all files properly formatted)
   ```

2. **Syntax Validation**
   ```bash
   terraform validate
   # Expected: Success confirmation
   ```

3. **Enhanced Test Coverage Validation**
   ```bash
   terraform test
   # Expected: All existing tests pass + new enhancement tests pass
   ```

4. **Regression Testing**
   ```bash
   # Verify existing functionality still works
   # Test existing variable combinations
   # Validate existing output consumers aren't broken
   ```

5. **Scope Compliance Validation**
   ```bash
   # Verify only allowed files modified
   git diff --name-only
   # Expected: Only configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
   ```

6. **Comprehensive Validation (Optional Enhancement)**
   ```bash
   # Use repository validation script if available
   ./scripts/utils/terraform-local-validation.sh --autofix {CONFIGURATION_NAME}
   ```

### Validation Fixes
If validation fails:
- **Format Issues**: Run `terraform fmt` to auto-correct
- **Syntax Issues**: Review error messages for actionable guidance  
- **Test Failures**: Verify assertion logic and enhanced functionality
- **Regression Issues**: Fix breaking changes, maintain backward compatibility
- **Scope Violations**: Remove unauthorized file modifications immediately

**Autofix Available**: The `terraform-local-validation.sh` script provides comprehensive autofix for common issues.
```

#### üìö **Required Instructions Compliance**
```markdown
## üìö Required Instructions Compliance

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

**MANDATORY**: Follow these instruction files exactly:

### Baseline Instructions
- **File**: `.github/instructions/baseline.instructions.md`
- **Key Requirements**: 
  - Security by design (OIDC authentication)
  - Keep it simple (clarity over cleverness)
  - Modularity (200 lines max per file)
  - Reusability (no code duplication)
  - Clear comments (explain "why", not "what")

### Terraform IaC Instructions  
- **File**: `.github/instructions/terraform-iac.instructions.md`
- **Key Requirements**:
  - AVM compliance with Power Platform adaptations
  - Provider version consistency (`~> 3.8`)
  - Strong variable typing (no `type = any`)
  - Anti-corruption layer outputs
  - Lifecycle management for res-* modules
  - Minimum test coverage by module type

### AVM Terraform Specifications
- **Reference**: Azure Verified Modules Terraform specs
- **Application**: Follow AVM patterns where technically feasible
- **Adaptations**: Document any Power Platform provider limitations
- **Future Planning**: Design for eventual full AVM compliance

### Enhancement-Specific Requirements
- **Backward Compatibility**: Maintain existing interfaces
- **Documentation**: Update comments to reflect enhancements
- **Testing**: Enhance test coverage for new functionality
```

#### ‚úÖ **Definition of Done**
```markdown
## ‚úÖ Definition of Done

**‚ö†Ô∏è SCOPE REMINDER**: Only modify configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md

**Enhancement Complete When**:
- [ ] All enhancement objectives achieved
- [ ] Existing functionality preserved (no breaking changes)
- [ ] `terraform fmt --check` passes with no output
- [ ] `terraform validate` passes syntax validation
- [ ] All existing tests continue to pass
- [ ] New tests added for enhanced functionality
- [ ] Variables maintain backward compatibility
- [ ] Outputs preserve existing structure while adding enhancements
- [ ] Documentation updated via terraform-docs
- [ ] CHANGELOG.md updated with enhancement details **ONLY**
- [ ] **SCOPE COMPLIANCE**: No unauthorized file modifications
- [ ] All repository standards and instructions followed within allowed scope
- [ ] Demonstrates PPCC25 educational objectives effectively
- [ ] Performance improvements verified (if applicable)
- [ ] Security enhancements validated (if applicable)

**Validation Commands**:
```bash
# Navigate to configuration
cd configurations/{CONFIGURATION_NAME}

# Validate formatting
terraform fmt --check

# Validate syntax  
terraform validate

# Run enhanced tests
terraform test

# Optional: Comprehensive validation
../../scripts/utils/terraform-local-validation.sh {CONFIGURATION_NAME}

# Verify scope compliance
cd ../../
git diff --name-only
# Should show ONLY: configurations/{CONFIGURATION_NAME}/* and CHANGELOG.md
```

**Review Criteria**:
- Enhancement objectives fully achieved
- Existing functionality preserved
- Code demonstrates quickstart guide principles
- Implementation shows best practices for enhancement
- Examples are clear and educational
- Troubleshooting guidance updated if needed
- Power Platform governance context maintained
- **Scope compliance maintained**: Only allowed files modified

## üö´ NEVER MODIFY THESE FILES:
- `LICENSE`
- `README.md`
- Anything in `.github/`
- Anything in `scripts/`
- Anything in `docs/`
- Any other `configurations/*/` (only target configuration allowed)
```

---

## üîß Enhancement-Type-Specific Templates

### For Feature Enhancements
```markdown
**Enhancement Focus**: Adding new functionality while maintaining existing behavior

**Specific Requirements**:
- **Feature Addition**: New capabilities without breaking changes
- **Interface Extension**: New variables/outputs with default behaviors
- **Test Coverage**: Comprehensive testing for new features
- **Documentation**: Clear examples of new functionality
```

### For Fix Enhancements
```markdown
**Enhancement Focus**: Correcting issues while preserving intended functionality

**Specific Requirements**:
- **Issue Resolution**: Address specific bugs or limitations
- **Regression Prevention**: Tests to prevent issue recurrence
- **Compatibility**: Maintain existing behavior where not buggy
- **Validation**: Verify fix doesn't introduce new issues
```

### For Optimization Enhancements
```markdown
**Enhancement Focus**: Improving performance while maintaining functionality

**Specific Requirements**:
- **Performance Metrics**: Measurable improvements
- **Resource Efficiency**: Optimize provider API calls
- **Scalability**: Handle larger datasets or configurations
- **Benchmarking**: Before/after performance validation
```

### For Compliance Enhancements
```markdown
**Enhancement Focus**: Meeting new standards while preserving functionality

**Specific Requirements**:
- **Standards Alignment**: AVM, security, or governance compliance
- **Policy Implementation**: Enforce new governance requirements
- **Audit Trail**: Enhanced logging and monitoring
- **Validation**: Compliance verification tests
```

### For Security Enhancements
```markdown
**Enhancement Focus**: Strengthening security posture while maintaining usability

**Specific Requirements**:
- **Security Controls**: Enhanced access controls and validation
- **Threat Mitigation**: Address identified security concerns
- **Principle of Least Privilege**: Tighten permissions where possible
- **Security Testing**: Validate security improvements
```

---

## üìã Usage Instructions

**To generate an enhancement GitHub issue:**

1. **Identify the target configuration** (existing configuration directory name)
2. **Specify enhancement type** (feature, fix, optimization, compliance, security)
3. **Define enhancement objectives** (specific improvements needed)
4. **Analyze current state** (understand existing functionality)
5. **Replace template variables** with specific enhancement details
6. **Customize enhancement-type template** based on enhancement classification
7. **Verify all required sections** are included and accurate

**The generated issue will provide GitHub Coding Agent with**:
- Step-by-step enhancement process
- All required validation commands
- Comprehensive technical specifications
- Clear enhancement objectives and definition of done
- Repository standards compliance requirements
- **Strict scope restrictions** to prevent unauthorized modifications
- Backward compatibility requirements to prevent breaking changes

This enhanced prompt creates actionable GitHub issues that eliminate ambiguity and ensure successful Terraform configuration enhancement through automated agents while protecting repository integrity and existing functionality through clearly defined, unavoidable scope restrictions.