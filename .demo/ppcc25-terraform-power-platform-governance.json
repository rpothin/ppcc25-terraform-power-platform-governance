{
  "$schema": "https://demotime.show/demo-time.schema.json",
  "title": "PPCC25 - Terraform Power Platform Governance",
  "description": "Demonstrations of using Terraform to enhance Power Platform Governance experience.",
  "version": 1,
  "timer": 50,
  "demos": [
    {
      "id": "demo-setup",
      "title": "Demo Setup",
      "description": "Setting up the demo environment by logging into GitHub CLI.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "unset GITHUB_TOKEN",
          "insertTypingMode": "instant",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh auth login",
          "insertTypingMode": "instant",
          "autoExecute": true,
          "terminalId": "demo"
        }
      ]
    },
    {
      "id": "dlp-policies-export",
      "title": "Demo 1.1: DLP Policies Export",
      "description": "Exporting Data Loss Prevention (DLP) policies using Terraform.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üéØ Press any key to trigger the Terraform Output workflow..."
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh workflow run terraform-output.yml -f configuration=utl-export-dlp-policies -f export_format=json -f include_metadata=true",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üí° Press any key to open the data_loss_prevention_policies data source documentation..."
        },
        {
          "action": "openWebsite",
          "url": "https://registry.terraform.io/providers/microsoft/power-platform/latest/docs/data-sources/data_loss_prevention_policies",
          "openInVSCode": false
        },
        {
          "action": "waitForInput",
          "message": "üí° Press any key to open the DLP export configuration..."
        },
        {
          "action": "open",
          "path": "configurations/utl-export-dlp-policies/main.tf"
        },
        {
          "action": "waitForInput",
          "message": "üîç Press any key to highlight the relevant code section..."
        },
        {
          "action": "highlight",
          "path": "configurations/utl-export-dlp-policies/main.tf",
          "position": "14:15",
          "highlightWholeLine": true,
          "zoom": 10
        },
        {
          "action": "waitForInput",
          "message": "üí° Press any key to open the GitHub Actions workflow that triggers the export..."
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-output.yml --limit 1",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-output.yml --limit 1 --json number,url",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üîÑ Press any key to pull the latest changes from the repository..."
        },
        {
          "action": "executeTerminalCommand",
          "command": "git pull",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üîç Press any key to open the just generated Terraform output file..."
        },
        {
          "action": "open",
          "path": "configurations/utl-export-dlp-policies/terraform-output-utl-export-dlp-policies.json"
        },
        {
          "action": "waitForInput",
          "message": "üîç Press any key to highlight a section we want to show in the output file..."
        },
        {
          "action": "highlight",
          "path": "configurations/utl-export-dlp-policies/terraform-output-utl-export-dlp-policies.json",
          "startPlaceholder": "\"display_name\": \"Copilot Studio",
          "zoom": 10,
          "endPlaceholder": " Autonomous Agents\","
        },
        {
          "action": "waitForInput",
          "message": "‚ûï Press any key continue the demonstration with the provisioning of a new DLP policy..."
        },
        {
          "action": "runDemoById",
          "id": "new-dlp-policy-provisioning"
        }
      ]
    },
    {
      "id": "new-dlp-policy-provisioning",
      "title": "Demo 1.2: New DLP Policy Provisioning",
      "description": "Provisioning of a new Data Loss Prevention (DLP) policy using Terraform.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üéØ Press any key to copy the template file..."
        },
        {
          "action": "executeTerminalCommand",
          "command": "cp configurations/res-dlp-policy/tfvars/template.tfvars configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üéØ Press any key to open the copied configuration file..."
        },
        {
          "action": "open",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars"
        },
        {
          "action": "waitForInput",
          "message": "üéØ Press any key to open the copied configuration file..."
        },
        {
          "action": "replace",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "content": "display_name = \"Dataverse only DLP policy\"",
          "position": "15:15",
          "highlightWholeLine": true,
          "insertTypingMode": "character-by-character"
        },
        {
          "action": "replace",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "content": "environments = []",
          "position": "26:26",
          "highlightWholeLine": true,
          "insertTypingMode": "character-by-character"
        },
        {
          "action": "replace",
          "position": "29:41",
          "highlightWholeLine": true,
          "content": "business_connectors = [\n  {\n    id                           = \"/providers/Microsoft.PowerApps/apis/shared_commondataservice\"\n    default_action_rule_behavior = \"Allow\"\n    action_rules                 = []\n    endpoint_rules               = []\n  }\n]",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "insertTypingMode": "line-by-line"
        },
        {
          "action": "replace",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "position": "46:49",
          "highlightWholeLine": true,
          "insertTypingMode": "line-by-line",
          "content": "custom_connectors_patterns = [\n  {\n    order            = 1\n    host_url_pattern = \"*\"\n    data_group       = \"Blocked\" # Security-first: block all custom connectors by default\n  }\n]"
        },
        {
          "action": "waitForInput",
          "message": "‚úÖ Configuration ready! Press any key to commit the changes..."
        },
        {
          "action": "executeTerminalCommand",
          "command": "git add configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git commit -m \"feat: add Dataverse-only DLP policy configuration\"",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git push",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üöÄ Press any key to trigger the Terraform Plan and Apply workflow..."
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh workflow run terraform-plan-apply.yml -f configuration=res-dlp-policy -f tfvars_file=live-demo -f apply=true -f extract_outputs=false",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "‚è≥ Waiting for deployment... Press any key to check workflow status..."
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-plan-apply.yml --limit 1",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-plan-apply.yml --limit 1 --json number,url,status,conclusion",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üîç Press any key to open Power Platform Admin Center to verify the deployed policy..."
        },
        {
          "action": "openWebsite",
          "url": "https://admin.powerplatform.microsoft.com/security/dataprotection/dlp",
          "openInVSCode": false
        }
      ]
    },
    {
      "id": "existing-dlp-policy-onboarding",
      "title": "Demo 1.3: Existing DLP Policy Onboarding",
      "description": "Generate configuration file for existing DLP Policy, import it and deploy changes using Terraform.",
      "steps": []
    },
    {
      "id": "environment-group-provisioning",
      "title": "Demo 2: Environment Group Provisioning",
      "description": "Provisioning of an entire environment group with its environments (Dev, Test and Prod) based on a selected template to enable a team to quickly start building.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üöÄ Starting Demo 2 - Press any key to begin..."
        },
        {
          "action": "showInfoMessage",
          "message": "Demo 2: Environment Management - Add your steps here"
        }
      ]
    },
    {
      "id": "azure-extension-provisioning",
      "title": "Demo 3: Azure Extension Provisioning",
      "description": "Provisioning of the extension of a Power Platform environment group in Azure with VNet integration to enable a team to quickly connect to Azure resources securely.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "waitForInput",
          "message": "üé¨ Starting Demo 3 - Press any key to begin..."
        },
        {
          "action": "showInfoMessage",
          "message": "Demo 3: Policy Automation - Add your steps here"
        }
      ]
    }
  ]
}