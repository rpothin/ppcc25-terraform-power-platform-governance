{
  "$schema": "https://demotime.show/demo-time.schema.json",
  "title": "PPCC25 - Terraform Power Platform Governance",
  "description": "Demonstrations of using Terraform to enhance Power Platform Governance experience.",
  "version": 1,
  "timer": 50,
  "demos": [
    {
      "id": "demo-setup",
      "title": "Demo Setup",
      "description": "Setting up the demo environment by logging into GitHub CLI.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "unset GITHUB_TOKEN",
          "insertTypingMode": "instant",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh auth login",
          "insertTypingMode": "instant",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "clear",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "openWebsite",
          "url": "https://registry.terraform.io/providers/microsoft/power-platform/latest/docs/data-sources/data_loss_prevention_policies",
          "openInVSCode": false
        },
        {
          "action": "pause"
        },
        {
          "action": "openWebsite",
          "url": "https://admin.powerplatform.microsoft.com/security/dataprotection/dlp",
          "openInVSCode": false
        }
      ]
    },
    {
      "id": "dlp-policies-export",
      "title": "Demo 1.1: DLP Policies Export",
      "description": "Exporting Data Loss Prevention (DLP) policies using Terraform.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh workflow run terraform-output.yml -f configuration=utl-export-dlp-policies -f export_format=json -f include_metadata=true",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "open",
          "path": "configurations/utl-export-dlp-policies/main.tf"
        },
        {
          "action": "pause"
        },
        {
          "action": "highlight",
          "path": "configurations/utl-export-dlp-policies/main.tf",
          "position": "14:15",
          "highlightWholeLine": true,
          "zoom": 10
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-output.yml --limit 1",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-output.yml --limit 1 --json number,url,status,conclusion",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git pull",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "open",
          "path": "configurations/utl-export-dlp-policies/terraform-output-utl-export-dlp-policies.json"
        },
        {
          "action": "pause"
        },
        {
          "action": "highlight",
          "path": "configurations/utl-export-dlp-policies/terraform-output-utl-export-dlp-policies.json",
          "startPlaceholder": "\"display_name\": \"Copilot Studio",
          "zoom": 10,
          "endPlaceholder": " Autonomous Agents\","
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "clear",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "closeAll"
        }
      ]
    },
    {
      "id": "new-dlp-policy-provisioning",
      "title": "Demo 1.2: New DLP Policy Provisioning",
      "description": "Provisioning of a new Data Loss Prevention (DLP) policy using Terraform.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "cp configurations/res-dlp-policy/tfvars/template.tfvars configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "open",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars"
        },
        {
          "action": "pause"
        },
        {
          "action": "replace",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "content": "display_name = \"Dataverse only DLP policy\"",
          "position": "15:15",
          "highlightWholeLine": true,
          "insertTypingMode": "character-by-character"
        },
        {
          "action": "replace",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "content": "environments = [\"Default-7e7df62f-7cc4-4e63-a250-a277063e1be7\"]",
          "position": "26:26",
          "highlightWholeLine": true,
          "insertTypingMode": "character-by-character"
        },
        {
          "action": "replace",
          "position": "29:41",
          "highlightWholeLine": true,
          "content": "business_connectors = [\n  {\n    id                           = \"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps\"\n    default_action_rule_behavior = \"\"\n    action_rules                 = []\n    endpoint_rules               = []\n  },\n  {\n    id                           = \"/providers/Microsoft.PowerApps/apis/shared_commondataservice\"\n    default_action_rule_behavior = \"\"\n    action_rules                 = []\n    endpoint_rules               = []\n  }\n]",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "insertTypingMode": "line-by-line"
        },
        {
          "action": "replace",
          "path": "configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "position": "52:55",
          "highlightWholeLine": true,
          "insertTypingMode": "line-by-line",
          "content": "custom_connectors_patterns = [\n  {\n    order            = 1\n    host_url_pattern = \"*\"\n    data_group       = \"Blocked\" # Security-first: block all custom connectors by default\n  }\n]"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git add configurations/res-dlp-policy/tfvars/live-demo.tfvars",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git commit -m \"feat: add Dataverse-only DLP policy configuration\"",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git push",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh workflow run terraform-plan-apply.yml -f configuration=res-dlp-policy -f tfvars_file=live-demo -f apply=true -f extract_outputs=false",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-plan-apply.yml --limit 1",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-plan-apply.yml --limit 1 --json number,url,status,conclusion",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git pull",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "clear",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "closeAll"
        }
      ]
    },
    {
      "id": "existing-dlp-policy-onboarding",
      "title": "Demo 1.3: Existing DLP Policy Onboarding",
      "description": "Generate configuration file for existing DLP Policy, import it and deploy changes using Terraform.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh workflow run terraform-output.yml -f configuration=utl-generate-dlp-tfvars -f terraform_variables=\"-var='source_policy_name=Copilot Studio Autonomous Agents'\" -f export_format=json -f include_metadata=true",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-output.yml --limit 1",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-output.yml --limit 1 --json number,url,status,conclusion",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git pull",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "mv configurations/utl-generate-dlp-tfvars/generated-dlp-policy.tfvars configurations/res-dlp-policy/tfvars/copilot-studio-autonomous-agents.tfvars",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "sed -i '/^blocked_connectors = \\[$/,/^]$/d' configurations/res-dlp-policy/tfvars/copilot-studio-autonomous-agents.tfvars",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "open",
          "path": "configurations/res-dlp-policy/tfvars/copilot-studio-autonomous-agents.tfvars"
        },
        {
          "action": "pause"
        },
        {
          "action": "highlight",
          "path": "configurations/res-dlp-policy/tfvars/copilot-studio-autonomous-agents.tfvars",
          "startPlaceholder": "display_name = \"Copilot Studio",
          "zoom": 10,
          "endPlaceholder": " Autonomous Agents\""
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git add configurations/res-dlp-policy/tfvars/copilot-studio-autonomous-agents.tfvars",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git commit -m \"feat: add generated tfvars for Copilot Studio Autonomous Agents DLP policy\"",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git push",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh workflow run terraform-import.yml -f configuration=res-dlp-policy -f tfvars_file=copilot-studio-autonomous-agents -f resource_type=powerplatform_data_loss_prevention_policy -f resource_name=this -f resource_id=3884a9cf-f15b-44ba-ac2a-4032ca6c396a -f backup_state=true",
          "insertTypingMode": "character-by-character",
          "autoExecute": false,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-import.yml --limit 1",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-import.yml --limit 1 --json number,url,status,conclusion",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh workflow run terraform-plan-apply.yml -f configuration=res-dlp-policy -f tfvars_file=copilot-studio-autonomous-agents -f apply=false -f extract_outputs=false",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-plan-apply.yml --limit 1",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "gh run list --workflow=terraform-plan-apply.yml --limit 1 --json number,url,status,conclusion",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git pull",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "clear",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "closeAll"
        }
      ]
    },
    {
      "id": "environment-group-provisioning",
      "title": "Demo 2: Environment Group Provisioning",
      "description": "Provisioning of an entire environment group with its environments (Dev, Test and Prod) based on a selected template to enable a team to quickly start building.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git pull",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "clear",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "closeAll"
        }
      ]
    },
    {
      "id": "azure-extension-provisioning",
      "title": "Demo 3: Azure Extension Provisioning",
      "description": "Provisioning of the extension of a Power Platform environment group in Azure with VNet integration to enable a team to quickly connect to Azure resources securely.",
      "steps": [
        {
          "action": "openTerminal",
          "terminalId": "demo"
        },
        {
          "action": "pause"
        },
        {
          "action": "executeTerminalCommand",
          "command": "git pull",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "executeTerminalCommand",
          "command": "clear",
          "insertTypingMode": "character-by-character",
          "autoExecute": true,
          "terminalId": "demo"
        },
        {
          "action": "closeAll"
        }
      ]
    }
  ]
}